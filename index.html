<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Splash</title>

<style>
  * { margin:0; padding:0; box-sizing:border-box; font-family: system-ui, sans-serif; }
  body { background: #FAFAFA; }
  #splash {
    position: fixed; top:0; left:0;
    width:100vw; height:100vh;
    background:#FAFAFA;
    display:flex; align-items:center; justify-content:center;
    z-index:9999;
  }
  #splash img {
    width:300px;
    animation: splashAnim 1.5s ease-in-out;
  }
  @keyframes splashAnim {
    0% { opacity:0; transform:scale(0.8); }
    50% { opacity:1; }
    100% { transform:scale(1); }
  }
</style>
</head>
<body>

<div id="splash">
  <img src="img1/logo.png" alt="Logo">
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
(async function(){
  // Configuración de Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyBw46PbDaRKV6EOBOCjhpwg03tsjFpR1iA",
    authDomain: "naranja-e02c1.firebaseapp.com",
    databaseURL: "https://naranja-e02c1-default-rtdb.firebaseio.com",
    projectId: "naranja-e02c1",
    storageBucket: "naranja-e02c1.firebasestorage.app",
    messagingSenderId: "361427675326",
    appId: "1:361427675326:android:a8809226a2e850c33d16ef"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  const deviceIdKey = 'deviceId';
  let deviceId = localStorage.getItem(deviceIdKey);
  if(!deviceId){
    // Genera un deviceId temporal de 16 caracteres
    deviceId = Math.random().toString(36).substr(2,16);
    localStorage.setItem(deviceIdKey, deviceId);
  }

  // Espera animación splash
  await new Promise(r => setTimeout(r, 1500));

  try {
    const snapshot = await db.ref('pines').get();
    const pines = snapshot.val();
    let sesionValida = false;

    // Buscar un PIN asociado a este deviceId
    for(const pin in pines){
      const p = pines[pin];
      if(p.device_id === deviceId){
        const activo = (p.activo === "true" || p.activo === true);
        const unlock = (p.action === "unlock");
        if(activo && unlock){
          sesionValida = true;
          break;
        }
      }
    }

    // Redirigir según sesión
    if(sesionValida){
      window.location.href = 'home.html';
    } else {
      window.location.href = 'login.html';
    }

  } catch(e){
    console.error('Error verificando sesión', e);
    window.location.href = 'login.html';
  }

})();
</script>

</body>
</html>